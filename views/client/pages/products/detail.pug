extends ../../layouts/default.pug

block main
  .container.py-5
    .row
      .col-lg-12
        nav(aria-label='breadcrumb')
          ol.breadcrumb.bg-color(data-bs-separator='/')
            li.breadcrumb-item
              a(href='/') Home  
            if (product.category)
              li.breadcrumb-item.active(aria-current='page')
                a(href=`/products/${product.category.slug}`) #{product.category.title}
            li.breadcrumb-item.active(aria-current='page') #{product.title}

    .row
      .col-lg-6
        if (product.thumbnail)
          .product-image.mb-4
            img.img-fluid.rounded.shadow(
              src=product.thumbnail
              alt=product.title
              style="object-fit: cover;"
            )

      .col-lg-6
        .product-details
          if (product.title)
            h1.display-4.mb-4.text-primary #{product.title}
          
          .card.bg-light.mb-4.shadow-hover
            .card-body.py-4
              .row
                if (product.price)
                  .col-6.mb-3
                    .product-info-item
                      label.info-label
                        i.fas.fa-tag.text-primary
                        span Price
                      .info-value
                        span.new-price $#{product.newPrice}
                        if product.price != product.newPrice
                          span.old-price $#{product.price}

                if (product.discountPercentage)
                  .col-6.mb-3
                    .product-info-item
                      label.info-label
                        i.fas.fa-percent.text-success
                        span Discount
                      .info-value.discount #{product.discountPercentage}%

                if (product.stock)
                  .col-6.mb-3
                    .product-info-item
                      label.info-label
                        i.fas.fa-box.text-info
                        span Stock
                      .info-value.stock #{product.stock}

                if (product.position)
                  .col-6.mb-3
                    .product-info-item
                      label.info-label
                        i.fas.fa-map-marker-alt.text-danger
                        span Position
                      .info-value.position #{product.position}

          .d-flex.mt-4.mb-2
            form.me-2(action=`/cart/add/${product.id}` method="POST")
              .mb-2
                label.form-label(for="quantity") Quantity
                input.form-control(
                  type="number"
                  name="quantity" 
                  id="quantity"
                  value="1"
                  min="1"
                  max=product.stock
                  onchange="updateCurrentPrice(this.value)"
                )
              button.btn.btn-primary.btn-lg.d-inline-flex.align-items-center.btn-block(type="submit")
                i.fas.fa-shopping-cart.me-2
                | Add to Cart
            .mt-2
              .col-6.mb-3
                  //- .product-info-item
                  label.form-label
                    i.fas.fa-percent.text-success
                    span Current Price:
                  span.info-value.discount#currentPrice $#{product.newPrice}
              //- label.form-label Current Price: 
              //- span#currentPrice $#{product.newPrice}
                
          button.btn.btn-outline-primary.btn-lg.d-inline-flex.align-items-center.mb-4
            i.fas.fa-heart.me-2
            | Add to Wishlist
            
          if (product.description)
            .card.mb-4.shadow-hover
              .card-header.bg-primary.text-white
                i.fas.fa-info-circle.mr-2
                | Product Description
              .card-body
                p.lead.mb-0 !{product.description}

  script.
    function updateCurrentPrice(quantity) {
      const basePrice = #{product.newPrice};
      const total = (basePrice * quantity).toFixed(1);
      document.getElementById('currentPrice').textContent = `$${total}`;
    }